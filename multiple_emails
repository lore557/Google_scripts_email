GOOGLE_SCRIP_SEND_AUTO_EMAIL:

function triggerOnEdit(e)
{
  sendEmailOnDone(e);
}

function checkStatusIsDone(e)
{
  var range = e.range;
  
  if(range.getColumn() <= 6 && 
     range.getLastColumn() >=6 )
  {
    var edited_row = range.getRow();
    
    var status = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Requirements');
    
    var sheet = status.getRange(edited_row, 6).getValue();
    
    var owner_name = status.getRange(edited_row, 2).getValue();
    
    var link = status.getRange(edited_row, 4).getValue();
    
    var issue = status.getRange(edited_row, 5).getValue();
    
    var owner_name_2 = status.getRange(edited_row, 1).getValue();
    
     if(sheet == 'Done' && owner_name_2 != "") //This is for two owners
    {
      
      var br_values = 
         {
           flag:2,
           ow_name: owner_name,
           ow_name2: owner_name_2,
           links: link,
           issue_n: issue
         } 
      return br_values

    }
    if (sheet == 'Done' && owner_name_2 == "")  
    { //This is just for one owner
     
      var br_values = 
         {
           flag:1,
           ow_name: owner_name,
           links: link,
           issue_n: issue
         } 
      return br_values;
      
    }
  }
    return;
}

function sendEmailOnDone(e)
{
  
  var br_values = checkStatusIsDone(e);
  
  owner(br_values);
  
}
 
function owner(br_values)
{      
  var values = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Owners').getRange(5,1,37,4).getValues();
  
  
  if (br_values.flag == 1)
  {
    for(var i = 0; i < 38; i++)
    {
      if (values[i][1] == br_values.ow_name)
      {
        var owners =
            {
              firts_name: br_values.ow_name,
              email: values[i][2],
              link: br_values.links,
              issue_num:br_values.issue_n 
            } 
        break
      }
      
    }
  sendEmail(owners)  
  }
 
 
 if (br_values.flag == 2) 
 {   
   for(var i = 0; i < 38; i++)
    {
      if (values[i][1] == br_values.ow_name2)
      {
        var owners =
            {
              firts_name: br_values.ow_name2,
              email: values[i][2],
              link: br_values.links,
              issue_num:br_values.issue_n 
            }
       sendEmail(owners)
      }
      if (values[i][1] == br_values.ow_name)
      {
        var owners =
            {
              firts_name: br_values.ow_name,
              email: values[i][2],
              link: br_values.links,
              issue_num:br_values.issue_n 
            }
        sendEmail(owners)
      }
     
    }
  
  
  }

}
  
function sendEmail(owners)
{
  var templ = HtmlService.createTemplateFromFile('email_subject');
  
  templ.owners = owners;
  
  var message = templ.evaluate().getContent();
  
  MailApp.sendEmail({
    to:owners.email, 
    replyTo: "spec-analysis@adheretech.com",
    subject: "Business Requirement Updated, Issue #" +owners.issue_num,
    htmlBody: message
  });

}



